<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SAE5_IHM: Référence du fichier src/main.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SAE5_IHM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Généré par Doxygen 1.13.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Recherche',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Chargement...</div>
<div class="SRStatus" id="Searching">Recherche...</div>
<div class="SRStatus" id="NoMatches">Aucune correspondance</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_df4170500cda4c5e0554b004e6e99923.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Fonctions</a>  </div>
  <div class="headertitle"><div class="title">Référence du fichier main.cpp<div class="ingroups"><a class="el" href="group___m5___core2.html">M5_Core2</a> &raquo; <a class="el" href="group___m5___core2___main.html">M5_Core2_Main</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Ce code permet de réaliser une IHM sur l'écran tactile du M5Core, permettant de faire l'ajout de différents appareils communiquant en BLE. Le code est principalement sérparé en trois parties séparées dans des tâches FreeRTOS et la loop principale :  
<a href="#details">Plus de détails...</a></p>
<div class="textblock"><code>#include &quot;project.h&quot;</code><br />
</div>
<p><a href="_m5___core2_2src_2main_8cpp_source.html">Aller au code source de ce fichier.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Fonctions</h2></td></tr>
<tr class="memitem:ga4fc01d736fe50cf5b977f755b675f11d" id="r_ga4fc01d736fe50cf5b977f755b675f11d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m5___core2___main.html#ga4fc01d736fe50cf5b977f755b675f11d">setup</a> ()</td></tr>
<tr class="separator:ga4fc01d736fe50cf5b977f755b675f11d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafe461d27b9c48d5921c00d521181f12f" id="r_gafe461d27b9c48d5921c00d521181f12f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m5___core2___main.html#gafe461d27b9c48d5921c00d521181f12f">loop</a> ()</td></tr>
<tr class="separator:gafe461d27b9c48d5921c00d521181f12f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Description détaillée</h2>
<div class="textblock"><p>Ce code permet de réaliser une IHM sur l'écran tactile du M5Core, permettant de faire l'ajout de différents appareils communiquant en BLE. Le code est principalement sérparé en trois parties séparées dans des tâches FreeRTOS et la loop principale : </p>
<pre class="fragment">- La première tâche est "Update_Display", comme son nom l'indique elle permet de mettre à jour
l'affichage sur l'écran. C'est la seule tâche qui peut modifier l'écran, permettant une meilleure
gestion de ce dernier.

- La seconde tâche est "Touch_Pressed". Cette tâche permet de réaliser l'intéraction tactile de
l'écran et les différentes actions que cela effectue. 

- La loop principale quand à elle s'occupe de maintenir la communication BLE du M5Core.

La communication BLE est initialisée par la fonction BLESetup(). Cette initialisation va créer
deux tâches FreeRTOS qui peuvent être considérées comme tâches mineures :

- Les tâches "BLE_Read" et "BLE_Write", permettent de faire la réception et l'envoi de données par la
communication BLE. Les données envoyées ou réceptionnées sont d'abord placées dans des queues (queueBLERead, 
queueBLEWrite). L'utilitée de ces queues est d'avoir une sauvegarde des différentes données et un traitement
dans l'ordre de ces dernières.
</pre><p>Le fonctionnement du M5Core se réalise d'abord par l'initialisation des différentes parties ainsi que de l'affichage du HOME_SCREEN sur l'écran. L'utilisateur a alors deux choix : le ADD_BUTTON (permet d'aller sur l'écran ADD_SCREEN) ou le MENU_BUTTON (permet d'aller sur l'écran MENU_SCREEN). Si l'utilisateur appuye sur ADD_BUTTON, il va voir afficher tous les différents appareils qui ont fait une demande d'ajout dans les 60 secondes (durée maximale pour valider l'ajout d'un appareil). L'utilisateur peut alors sélectionner l'appareil souhaité pour ensuite le valider ou le refuser avec les différents boutons. Il peut aussi revenir sur l'écran HOME_SCREEN en appuyant sur la petite maison. Une fois un appareil validé, il peut le retrouver sur le MENU_SCREEN qui affiche tous les appareils enregistrés (par la suite on pourra rajouter une intéraction permettant d'aller sur les IHM des différents groupes avec leurs capteurs). <br  />
</p>
<p>Au niveau de la communication BLE, les trames sont très ressemblantes au JSON. Par exemple, une trame ressemble à ceci :</p><ul>
<li>{"action":2,"idDevice":2,"idTypeDevice":2,"uid":"FF:FF:FF:FF:FF","nom":"Chambre"}.</li>
</ul>
<p>On a différents paramètres comme "action" qui dit ce que fait le message (1 -&gt; ajout d'appareil déjà connu, 2 -&gt; ajout d'appareil, 3 -&gt; Info). Il y a aussi "idTypeDevice" qui dit le type de l'appareil, "uid" qui dit son adresse UID, et puis il y a "nom" qui est le nom de l'appareil. C'est une trame typique de celle reçue par le M5 Core.</p>
<p>On a aussi un autre type de trame très similaire qui est envoyée par le M5Core, pour dire si l'appareil est validé ou refusé par ce dernier. Les trames sont {"action":3,"info":"valid"} ou {"action":3,"info":"denied"}</p>
<ul>
<li>Maintenance: Au niveau de la maintenance du code, il y a plusieurs options qui permettent de traiter tout problème obtenu:<ul>
<li>Notamment le DEBUG_MODE qui permet d'activer ou de désactiver la communication Série qui permet le renvoi de toutes les actions éffectuées par le M5Core. Mais aussi, qui permet de lui envoyer des trames que le M5Core va traiter. Cela permet de tester le M5 si on n'a pas d'appareil qui communique en BLE disponible.</li>
<li>Il y a aussi le BLE_MODE qui permet d'activer ou désactiver la communication BLE et donc de choisir de tester si un problème survient à cause de la communication BLE.</li>
</ul>
</li>
<li>Test: Trame qui permet de tester le M5Core {"action":1,"idDevice":1,"idTypeDevice":1,"uid":"FF:FF:FF:FF:FF","nom":"Salle de bain"} {"action":2,"idDevice":2,"idTypeDevice":2,"uid":"11:22:33:44:55","nom":"Chambre"} {"action":2,"idDevice":3,"idTypeDevice":4,"uid":"AA:BB:CC:DD:EE:FF","nom":"Cuisine"}</li>
<li>Environnement: M5 Stack Core2</li>
<li>Librairie: ArduinoBLE M5Core2</li>
</ul>
<dl class="section author"><dt>Auteur</dt><dd>Bartholin Matthieu, Marjorie Koehl, Lucas Lapoirière </dd></dl>
<dl class="section date"><dt>Date</dt><dd>02/01/2025 </dd></dl>

<p class="definition">Définition dans le fichier <a class="el" href="_m5___core2_2src_2main_8cpp_source.html">main.cpp</a>.</p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Généré par&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
